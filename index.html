<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Feliz Anivers√°rio, Helena!</title>
<style>
  :root{
    --accent:#FF3D84;
    --bg1:linear-gradient(180deg,#87CEFA 0%, #FFF9F6 62%);
    --card:rgba(255,255,255,.98);
    --shadow:0 8px 24px rgba(0,0,0,.12);
    --ui:14px;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Helvetica Neue',Arial,sans-serif;background:var(--bg1);-webkit-font-smoothing:antialiased}
  #stage{position:relative;width:100vw;height:100vh;overflow:hidden;touch-action:none;padding-top:64px}
  /* clouds background */
  .clouds{position:absolute;left:0;top:0;right:0;bottom:0;z-index:0;pointer-events:none;overflow:hidden}
  .cloud{position:absolute;font-size:84px;opacity:.85;transform:translateX(-20%);will-change:transform}
  @keyframes floatCloud1{0%{transform:translateX(-30%)}100%{transform:translateX(120%)}}
  @keyframes floatCloud2{0%{transform:translateX(-40%)}100%{transform:translateX(110%)}}
  @keyframes floatCloud3{0%{transform:translateX(-20%)}100%{transform:translateX(125%)}}
  /* foreground UI */
  .topbar{position:fixed;left:0;right:0;top:8px;display:flex;justify-content:space-between;padding:8px 12px;gap:12px;z-index:800;pointer-events:none}
  .topLeft{pointer-events:auto}
  .topRight{pointer-events:auto}
  .btn{background:var(--card);border-radius:12px;padding:8px 12px;box-shadow:var(--shadow);cursor:pointer;border:0;font-weight:800;font-size:var(--ui)}
  .present{position:fixed;right:12px;bottom:calc(16px + env(safe-area-inset-bottom));font-size:56px;z-index:790;background:var(--card);padding:6px;border-radius:10px;box-shadow:var(--shadow);cursor:pointer;pointer-events:auto}
  .score{position:fixed;left:12px;bottom:14px;background:var(--card);padding:8px 12px;border-radius:12px;box-shadow:var(--shadow);z-index:790;font-weight:900}
  .lives{position:fixed;right:12px;bottom:14px;background:var(--card);padding:8px 12px;border-radius:12px;box-shadow:var(--shadow);z-index:790}
  .centerBanner{position:fixed;left:50%;top:12%;transform:translateX(-50%);z-index:795;background:linear-gradient(90deg,rgba(255,255,255,.95),rgba(255,250,250,.95));padding:10px 18px;border-radius:14px;box-shadow:var(--shadow);font-weight:900;color:var(--accent);font-size:22px;text-align:center;display:none}
  /* game area and elements */
  #gameArea{position:absolute;inset:0;z-index:10;pointer-events:auto}
  #fxCanvas{position:absolute;left:0;top:0;width:100%;height:100%;z-index:700;pointer-events:none}
  .balloon{position:absolute;font-size:48px;z-index:120;cursor:pointer;user-select:none;touch-action:none;transform-origin:center}
  .floating-unlock{position:absolute;font-size:56px;z-index:150;pointer-events:none;animation:riseUp 6s linear forwards}
  @keyframes riseUp{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(-140vh) rotate(30deg);opacity:0}}
  /* box modal (preserve original look) */
  .boxOverlay{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;z-index:880}
  .boxCard{background:var(--card);padding:18px;border-radius:14px;box-shadow:var(--shadow);width:92%;max-width:520px;text-align:center}
  .cakeEmoji{font-size:84px}
  .candles{display:flex;gap:12px;justify-content:center;margin-top:8px}
  .vela{font-size:28px;cursor:pointer}
  .boxMessage{margin-top:12px;font-weight:900;color:var(--accent);font-size:20px}
  /* confetti overlay subtle in background */
  .confettiLayer{position:absolute;left:0;top:0;width:100%;height:100%;z-index:50;pointer-events:none}
  /* small responsive tweaks */
  @media(max-width:600px){
    .cloud{font-size:56px}
    .present{font-size:48px}
    .cakeEmoji{font-size:62px}
    .centerBanner{font-size:18px;top:10%}
  }
</style>
</head>
<body>
  <div id="stage">
    <!-- clouds background -->
    <div class="clouds" aria-hidden="true">
      <div class="cloud" style="left:-10%;top:6%;animation:floatCloud1 60s linear infinite;">‚òÅÔ∏è</div>
      <div class="cloud" style="left:-20%;top:18%;font-size:96px;opacity:.8;animation:floatCloud2 80s linear infinite;">‚òÅÔ∏è</div>
      <div class="cloud" style="left:-15%;top:34%;font-size:76px;opacity:.9;animation:floatCloud3 70s linear infinite;">‚òÅÔ∏è</div>
    </div>

    <div class="topbar">
      <div class="topLeft">
        <button id="menuOpen" class="btn">‚ãØ Menu</button>
      </div>
      <div class="topRight">
        <button id="effectsBtn" class="btn">üîä Efeitos: ON</button>
        <button id="modeBtn" class="btn">Modo: Casual</button>
      </div>
    </div>

    <div id="gameArea" aria-live="polite"></div>
    <canvas id="fxCanvas" aria-hidden="true"></canvas>

    <div class="centerBanner" id="centerBanner">FELIZ ANIVERS√ÅRIO, HELENA!!</div>

    <div class="score" id="scoreBox">Pontos: <span id="score">0</span></div>
    <div class="lives" id="livesBox" style="display:none">Vidas: <span id="lives">5</span></div>

    <button class="present" id="presentBtn" aria-label="Abrir presente">üéÅ</button>

    <!-- box modal -->
    <div class="boxOverlay" id="boxOverlay" aria-hidden="true">
      <div class="boxCard" role="dialog" aria-modal="true">
        <div style="display:flex;justify-content:flex-end">
          <button id="closeBox" class="btn">Fechar</button>
        </div>
        <div class="cakeEmoji">üéÇ</div>
        <div class="candles" id="candles"></div>
        <div class="boxMessage" id="boxMessage">FELIZ ANIVERS√ÅRIO, HELENA!!</div>
        <div style="margin-top:10px;font-size:12px">Toque nas velas para apagar ‚Äî 3 cliques totais</div>
      </div>
    </div>

    <!-- menu (simple) -->
    <div class="menuOverlay" id="menuOverlay" style="display:none;align-items:center;justify-content:center;" aria-hidden="true">
      <div class="boxCard">
        <h3>Op√ß√µes</h3>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
          <button id="casualMode" class="btn">Casual</button>
          <button id="challengeMode" class="btn">Challenge</button>
          <button id="survivalMode" class="btn">Survival</button>
          <button id="puzzleMode" class="btn">Puzzle</button>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
          <button id="menuClose" class="btn">Fechar</button>
        </div>
      </div>
    </div>

    <div class="confettiLayer" id="confettiLayer"></div>
  </div>

<script>
/* MASTER RECONSTRU√çDO ‚Äî tudo em um arquivo:
   - nuvens no fundo (CSS)
   - bal√µes sempre (spawn cont√≠nuo)
   - confetes via canvas/particles
   - caixa presente com bolo + velas (3 cliques apagam)
   - clicar no bolo alterna mensagem grande (parab√©ns / dinda+ dindo)
   - efeitos on/off
   - challenge: perder vida se deixa passar
   - responsive
*/

/* ---------- elements ---------- */
const gameArea = document.getElementById('gameArea');
const fxCanvas = document.getElementById('fxCanvas');
const ctx = fxCanvas.getContext('2d');
const presentBtn = document.getElementById('presentBtn');
const boxOverlay = document.getElementById('boxOverlay');
const closeBox = document.getElementById('closeBox');
const candlesEl = document.getElementById('candles');
const boxMessage = document.getElementById('boxMessage');
const centerBanner = document.getElementById('centerBanner');
const scoreEl = document.querySelector('#scoreBox #score');
const livesBox = document.getElementById('livesBox');
const livesEl = livesBox.querySelector('#lives');
const menuOpen = document.getElementById('menuOpen');
const menuOverlay = document.getElementById('menuOverlay');
const menuClose = document.getElementById('menuClose');
const effectsBtn = document.getElementById('effectsBtn');
const modeBtn = document.getElementById('modeBtn');

/* ---------- state ---------- */
const CHILD = 'HELENA';
let MODE = 'casual'; // casual, challenge, survival, puzzle
let FX_ON = true;
let audioCtx = null;

let score = 0;
let poppedCount = 0;
let balloons = [];
let particles = [];
let lastSpawn = 0;
let SPAWN_RATE = 1100;
let MAX_BALLOONS = 8;
let LIVES = 5;
let candleClicks = 0;
let presentStage = 0; // 0: closed, 1: shown feliz, 2: shown dinda
let lastPhrase = '';

/* phrase pools & mascots */
const POP_PHRASES = ['Muito bem!','Uhul!','Pop! Que legal!','Amo isso!','Voc√™ conseguiu!','Yay!','Que r√°pido!','Lindo!'];
const MILESTONE_PHRASES = ['Uau! Voc√™ arrasou!','Brilhante! üéâ','Que incr√≠vel!','Super estrela!','Parab√©ns, campe√£!'];
const UNLOCK_PHRASES = ['Olha o unic√≥rnio!','Voc√™ desbloqueou um amigo!','Surpresa m√°gica!','Mais um amiguinho!'];
const MASCOT_EMOJIS = ['ü¶Ñ','üß∏','üê±','üê∂','üêµ','üê•','üêº'];

/* ---------- utilities ---------- */
function pickRandomDifferent(list){
  if(!list || list.length===0) return '';
  if(list.length===1) return list[0];
  let pick, attempts=0;
  do{ pick = list[Math.floor(Math.random()*list.length)]; attempts++; } while(pick === lastPhrase && attempts < 10);
  lastPhrase = pick;
  return pick;
}

/* canvas resize */
function resizeCanvas(){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  fxCanvas.width = Math.round(window.innerWidth * dpr);
  fxCanvas.height = Math.round(window.innerHeight * dpr);
  fxCanvas.style.width = window.innerWidth + 'px';
  fxCanvas.style.height = window.innerHeight + 'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

/* audio (simple synth) */
function initAudio(){ if(audioCtx) return; try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }catch(e){ audioCtx = null; console.warn('Audio indispon√≠vel'); } }
function playTone(freq, dur=120, vol=0.03, type='sine', offset=0){ if(!audioCtx || !FX_ON) return; try{ const t = audioCtx.currentTime + offset/1000; const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type = type; o.frequency.setValueAtTime(freq, t); g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(vol, t+0.02); o.connect(g); g.connect(audioCtx.destination); o.start(t); o.stop(t + dur/1000 + 0.02);}catch(e){} }
function chime(kind='pop'){ if(!audioCtx || !FX_ON) return; if(kind==='pop') playTone(880,80,0.03,'triangle'); else if(kind==='milestone'){ playTone(660,140,0.03,'sine'); playTone(880,160,0.02,'sine',80); } else if(kind==='unicorn'){ playTone(880,140,0.03,'sine'); playTone(1200,160,0.02,'sine',90); } }

/* ---------- particles/confetti ---------- */
function spawnParticleEmoji(x,y,emoji){ particles.push({x,y,vx:(Math.random()-0.5)*6,vy:(-1-Math.random()*3),life:700+Math.random()*600,born:performance.now(),emoji,size:12+Math.random()*18,gravity:0.06}); }
function spawnConfetti(x,y,qty=30){ const colors=['#FF4DA6','#FFD166','#8AE6C1','#9CB4FF','#FFD1DC']; for(let i=0;i<qty;i++){ particles.push({x,y,vx:(Math.random()-0.5)*10,vy:(-2-Math.random()*6),life:900 + Math.random()*700,born:performance.now(),color:colors[Math.floor(Math.random()*colors.length)],w:6+Math.random()*10,h:10+Math.random()*20,gravity:0.06,rot:Math.random()*360}); } }

/* ---------- floating mascots ---------- */
function spawnSmallMascot(x,y){
  const emoji = MASCOT_EMOJIS[Math.floor(Math.random()*MASCOT_EMOJIS.length)];
  const el = document.createElement('div'); el.className = 'floating-unlock'; el.textContent = emoji; el.style.left = (x + (Math.random()-0.5)*40) + 'px'; el.style.top = y + 'px'; gameArea.appendChild(el); el.addEventListener('animationend', ()=> el.remove());
}

/* ---------- balloons (core) ---------- */
function spawnBalloon(type='normal'){
  if(balloons.length >= MAX_BALLOONS) return;
  const el = document.createElement('div'); el.className = 'balloon';
  let emoji='üéà', kind='pop', points=1;
  if(type==='unicorn'){ emoji='ü¶Ñ'; kind='unicorn'; points=3; }
  if(type==='bear'){ emoji='üß∏'; kind='bear'; points=2; }
  if(type==='cat'){ emoji='üê±'; kind='cat'; points=2; }
  el.textContent = emoji;
  const x = Math.random() * (window.innerWidth - 80) + 40;
  let y = window.innerHeight + 80;
  el.style.left = x + 'px'; el.style.top = y + 'px';
  gameArea.appendChild(el);
  const b = {el,x,y,vy:0.9 + Math.random()*1.6,sway:Math.random()*0.8,popped:false,kind,points};
  el.addEventListener('pointerdown', (ev)=>{ ev.stopPropagation(); if(b.popped) return; b.popped = true; handlePop(b); }, {passive:true});
  balloons.push(b);
}

function handlePop(b){
  try{ b.el.textContent='‚ú®'; b.el.style.transform='scale(1.1) rotate(6deg)'; }catch(e){}
  chime(b.kind);
  score += b.points; document.getElementById('score').textContent = score;
  poppedCount++;
  const pool = (b.kind==='unicorn')?['‚ú®','üíñ','üåà']:(b.kind==='bear')?['üíñ','üß∏','‚ú®']:(b.kind==='cat')?['‚ú®','üêæ','üíñ']:['‚ú®','üíñ','üåü'];
  for(let i=0;i<8;i++) spawnParticleEmoji(b.x + (Math.random()-0.5)*30, b.y - 30 + (Math.random()-0.5)*20, pool[Math.floor(Math.random()*pool.length)]);
  setTimeout(()=>{ try{ b.el.remove(); }catch(e){} },240);
  // casual messages & mascots
  if(MODE === 'casual'){
    const p = pickRandomDifferent(POP_PHRASES);
    showBanner(p,900);
    if(Math.random() < 0.35) spawnSmallMascot(b.x, b.y);
  }
  if(poppedCount % 7 === 0){ // milestone every 7 pops
    const mp = pickRandomDifferent(MILESTONE_PHRASES);
    showBanner(mp,1300); chime('milestone'); spawnConfetti(window.innerWidth/2, window.innerHeight/2, 40);
    SPAWN_RATE = Math.max(400, SPAWN_RATE - 80); MAX_BALLOONS = Math.min(18, MAX_BALLOONS + 1);
  }
  checkUnlocks();
}

/* when balloon goes offscreen -> miss in challenge */
function handleOffscreen(i){
  const b = balloons[i];
  if(!b) return;
  try{ b.el.remove(); }catch(e){}
  balloons.splice(i,1);
  if(MODE === 'challenge'){
    LIVES -= 1; livesEl.textContent = LIVES; chime('bear');
    showBanner('Ops! Perdeu 1 vida', 900);
    if(LIVES <= 0) handleGameOver();
  }
}

/* unlocks */
const UNLOCKS = [{score:7,key:'unicorn',emoji:'ü¶Ñ'},{score:15,key:'bear',emoji:'üß∏'},{score:30,key:'cat',emoji:'üê±'}];
let unlocked = new Set();
function checkUnlocks(){
  for(const u of UNLOCKS){
    if(score >= u.score && !unlocked.has(u.key)){
      unlocked.add(u.key); spawnFloatingUnlock(u.emoji); spawnBalloon(u.key);
      const up = pickRandomDifferent(UNLOCK_PHRASES);
      showBanner(up,1100);
    }
  }
}
function spawnFloatingUnlock(emoji){
  const el = document.createElement('div'); el.className='floating-unlock'; el.textContent=emoji;
  el.style.left = (window.innerWidth/2 + (Math.random()-0.5)*160) + 'px';
  el.style.top = (window.innerHeight*0.6 + (Math.random()-0.5)*40) + 'px';
  gameArea.appendChild(el); el.addEventListener('animationend', ()=> el.remove());
}

/* ---------- banner (big messages near top) ---------- */
function showBanner(txt, ms=1200){
  centerBanner.textContent = txt; centerBanner.style.display = 'block';
  clearTimeout(centerBanner._t);
  centerBanner._t = setTimeout(()=> centerBanner.style.display = 'none', ms);
}

/* ---------- animate loop (balloons + particles) ---------- */
let lastFrame = performance.now();
function animate(now){
  const dt = now - lastFrame; lastFrame = now;
  if(now - lastSpawn > SPAWN_RATE){
    if(Math.random() < 0.10){
      const r = Math.random();
      if(r < 0.25) spawnBalloon('unicorn');
      else if(r < 0.55) spawnBalloon('bear');
      else spawnBalloon('cat');
    } else spawnBalloon('normal');
    lastSpawn = now;
  }
  for(let i=balloons.length-1;i>=0;i--){
    const b = balloons[i];
    b.y -= b.vy * (dt/16);
    const sway = Math.sin((now/600) + b.sway*10) * 18;
    b.x += (sway * 0.0009) * (dt/16);
    if(b.el){ b.el.style.top = b.y + 'px'; b.el.style.left = b.x + 'px'; }
    if(b.y < -160) handleOffscreen(i);
  }
  // particles on canvas
  ctx.clearRect(0,0,fxCanvas.width,fxCanvas.height);
  const keep = [];
  for(const p of particles){
    const age = now - p.born;
    if(age > p.life) continue;
    p.vy += (p.gravity || 0.04) * (dt/16);
    p.x += p.vx * (dt/16);
    p.y += p.vy * (dt/16);
    const alpha = Math.max(0, 1 - (age / p.life));
    ctx.globalAlpha = alpha;
    if(p.emoji){
      ctx.font = (p.size || 18) + 'px serif';
      ctx.fillText(p.emoji, p.x, p.y);
    } else {
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate((p.rot||0) * Math.PI/180 * (age/500));
      ctx.fillStyle = p.color || '#fff'; ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h); ctx.restore();
    }
    ctx.globalAlpha = 1;
    keep.push(p);
  }
  particles.length = 0; particles.push(...keep);
  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);

/* ---------- present & box/cake/velas ---------- */
/* present click opens box; cake inside has click behavior to alternate message */
presentBtn.addEventListener('click', ()=> toggleBox());
closeBox.addEventListener('click', ()=> closeBox());

function toggleBox(){
  if(boxOverlay.style.display === 'flex'){ closeBox(); } else openBox();
}
function openBox(){
  boxOverlay.style.display = 'flex'; boxOverlay.setAttribute('aria-hidden','false');
  createCandles();
  resetCandlesState();
  // show central large banner with Feliz message when box opens
  showBanner(`FELIZ ANIVERS√ÅRIO, ${CHILD}!!`, 2500);
  // spawn some celebratory confetti
  spawnConfetti(window.innerWidth/2, window.innerHeight/2, 30);
  // ensure audio context ready
  if(!audioCtx) initAudio();
  // set presentStage to first message
  presentStage = 1;
  boxMessage.textContent = `FELIZ ANIVERS√ÅRIO, ${CHILD}!!`;
}

// close box but keep background running
function closeBox(){
  boxOverlay.style.display = 'none'; boxOverlay.setAttribute('aria-hidden','true');
}

/* candles creation & handling */
function createCandles(){
  candlesEl.innerHTML = '';
  for(let i=0;i<3;i++){
    const d = document.createElement('div'); d.className = 'vela'; d.textContent = 'üïØÔ∏è'; d.dataset.idx = i;
    d.addEventListener('click', ()=> handleCandle(d), {passive:true});
    candlesEl.appendChild(d);
  }
}
function resetCandlesState(){ candleClicks = 0; const velas = candlesEl.querySelectorAll('.vela'); velas.forEach(v=> v.textContent = 'üïØÔ∏è'); }

/* candle click logic: 3 clicks total => extinguish */
function handleCandle(el){
  if(!audioCtx) initAudio();
  chime('pop');
  candleClicks++;
  if(candleClicks >= 3){
    const velas = candlesEl.querySelectorAll('.vela');
    velas.forEach(v => v.textContent = 'üí®');
    boxMessage.textContent = `Voc√™ apagou as velinhas! Parab√©ns, ${CHILD}! üéÇ‚ú®`;
    showBanner(`Voc√™ apagou as velinhas, ${CHILD}!`, 2200);
    spawnConfetti(window.innerWidth/2, window.innerHeight/2, 50);
    // after extinguish, still allow reopening to reset (resetCandlesState on reopen)
  } else {
    showBanner(`Faltam ${3 - candleClicks} sopros`, 900);
  }
}

/* cake click toggles message between parabens and family message */
document.querySelector('.cakeEmoji').addEventListener('click', ()=> {
  if(!audioCtx) initAudio();
  chime('pop');
  if(presentStage === 1){
    boxMessage.textContent = `A dinda Thami e o dindo Gabi amam muito voc√™!`;
    presentStage = 2;
    showBanner(`A dinda Thami e o dindo Gabi amam muito voc√™!`, 1800);
  } else {
    boxMessage.textContent = `FELIZ ANIVERS√ÅRIO, ${CHILD}!!`;
    presentStage = 1;
    showBanner(`FELIZ ANIVERS√ÅRIO, ${CHILD}!!`, 1500);
  }
});

/* ---------- modes, menu ---------- */
menuOpen.addEventListener('click', ()=> { menuOverlay.style.display='flex'; menuOverlay.setAttribute('aria-hidden','false'); });
menuClose.addEventListener('click', ()=> { menuOverlay.style.display='none'; menuOverlay.setAttribute('aria-hidden','true'); });

document.getElementById('casualMode').addEventListener('click', ()=> setMode('casual'));
document.getElementById('challengeMode').addEventListener('click', ()=> setMode('challenge'));
document.getElementById('survivalMode').addEventListener('click', ()=> setMode('survival'));
document.getElementById('puzzleMode').addEventListener('click', ()=> setMode('puzzle'));

effectsBtn.addEventListener('click', ()=> { FX_ON = !FX_ON; effectsBtn.textContent = FX_ON ? 'üîä Efeitos: ON' : 'üîá Efeitos: OFF'; if(!audioCtx) initAudio(); });

function setMode(m){
  MODE = m;
  modeBtn.textContent = 'Modo: ' + (m === 'casual' ? 'Casual' : m === 'challenge' ? 'Challenge' : m === 'survival' ? 'Survival' : 'Puzzle');
  // reset game state lightly
  score = 0; poppedCount = 0; document.getElementById('score').textContent = score;
  SPAWN_RATE = (m==='casual') ? 1300 : (m==='challenge' ? 1000 : 1200);
  MAX_BALLOONS = (m==='casual') ? 6 : (m==='challenge' ? 8 : 6);
  LIVES = (m==='challenge') ? 5 : LIVES;
  livesEl.textContent = LIVES;
  livesBox.style.display = (m==='challenge') ? 'block' : 'none';
  showBanner(m === 'casual' ? 'Modo Casual' : m === 'challenge' ? 'Modo Challenge' : m==='survival' ? 'Modo Survival' : 'Puzzle (em breve)', 1000);
}

/* ---------- game over (challenge) ---------- */
function handleGameOver(){
  SPAWN_RATE = 999999;
  showBanner('Game Over üòÖ', 1800);
  setTimeout(()=> {
    centerBanner.innerHTML = 'Game Over ‚Äî <button id="restartBtn" class="btn">Reiniciar</button>';
    centerBanner.style.display = 'block';
    document.getElementById('restartBtn').addEventListener('click', ()=> {
      centerBanner.style.display = 'none';
      setMode('casual');
      SPAWN_RATE = 1100;
      LIVES = 5; livesEl.textContent = LIVES;
      document.getElementById('score').textContent = 0;
    });
  }, 700);
}

/* ---------- unlock helpers ---------- */
function spawnFloatingUnlock(emoji){
  const el = document.createElement('div'); el.className = 'floating-unlock'; el.textContent = emoji; el.style.left = (window.innerWidth/2 + (Math.random()-0.5)*160) + 'px'; el.style.top = (window.innerHeight*0.6 + (Math.random()-0.5)*40) + 'px'; gameArea.appendChild(el); el.addEventListener('animationend', ()=> el.remove());
}

/* ---------- audio unlock on gesture ---------- */
document.body.addEventListener('pointerdown', ()=> { if(!audioCtx) initAudio(); if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{}); }, {once:true,passive:true});

/* ---------- init: some balloons + cloud feel + start mode ---------- */
setMode('casual');
lastSpawn = performance.now();
for(let i=0;i<4;i++) setTimeout(()=> spawnBalloon(), i*250);

/* ---------- ensure canvas has initial size ---------- */
resizeCanvas();

/* end of script */
</script>
</body>
</html>
